<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#27ae60">
    <meta name="description" content="Calculate tree's carbon absorption, oxygen production & environmental impact">
    <title>üå≥ EcoTree Tracker - Tree Carbon & Oxygen Calculator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- HTML2PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Floating Leaves Background -->
    <div id="leavesContainer" class="leaves-container"></div>
    
    <!-- Confetti Container -->
    <div id="confettiContainer" class="confetti-container"></div>
    
    <!-- Dark Mode Toggle -->
    <button id="darkModeToggle" class="dark-mode-toggle" title="Toggle Dark Mode">
        <i class="fas fa-moon" id="darkModeIcon"></i>
    </button>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <img src="logo.svg" alt="EcoTree Tracker Logo" class="logo">
                <div class="header-text">
                    <h1>üå≥ EcoTree Tracker</h1>
                    <p>Calculate carbon absorption, oxygen production & environmental impact</p>
                </div>
                <button id="installBtn" class="install-btn" style="display: none;">
                    <i class="fas fa-download"></i> Install App
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Input Form Section -->
        <section class="card input-section">
            <h2><i class="fas fa-tree"></i> Tree Details</h2>
            <form id="treeForm">
                <!-- Tree Species -->
                <div class="form-group">
                    <label for="treeSpecies">
                        <i class="fas fa-leaf"></i> Tree Species
                    </label>
                    <input type="text" id="treeSearch" placeholder="Search tree species..." autocomplete="off">
                    <select id="treeSpecies" required size="5" style="display:none;">
                        <option value="">Select Tree Species</option>
                    </select>
                    <div id="treeDropdown" class="tree-dropdown"></div>
                </div>

                <!-- Height Input -->
                <div class="form-group">
                    <label for="height">
                        <i class="fas fa-ruler-vertical"></i> Tree Height
                    </label>
                    <div class="input-with-unit">
                        <input type="number" id="height" step="0.1" min="0.1" placeholder="Enter height" required>
                        <select id="heightUnit">
                            <option value="m">Meters (m)</option>
                            <option value="ft">Feet (ft)</option>
                            <option value="cm">Centimeters (cm)</option>
                        </select>
                    </div>
                </div>

                <!-- DBH Input -->
                <div class="form-group">
                    <label for="dbh">
                        <i class="fas fa-arrows-alt-h"></i> DBH (Diameter at Breast Height)
                    </label>
                    <div class="input-with-unit">
                        <input type="number" id="dbh" step="0.1" min="0.1" placeholder="Enter diameter" required>
                        <select id="dbhUnit">
                            <option value="cm">Centimeters (cm)</option>
                            <option value="in">Inches (in)</option>
                        </select>
                    </div>
                </div>

                <!-- Age (Optional) -->
                <div class="form-group">
                    <label for="age">
                        <i class="fas fa-calendar-alt"></i> Tree Age (Optional)
                    </label>
                    <input type="number" id="age" min="1" placeholder="Enter age in years">
                </div>

                <!-- Location (Optional) -->
                <div class="form-group">
                    <label for="location">
                        <i class="fas fa-map-marker-alt"></i> Location (Optional)
                    </label>
                    <input type="text" id="location" placeholder="e.g., Mumbai, Delhi">
                </div>

                <!-- Calculate Button -->
                <button type="submit" class="btn-primary">
                    <i class="fas fa-calculator"></i> Calculate
                </button>
            </form>
        </section>

        <!-- Results Section -->
        <section id="resultsSection" class="results-section" style="display: none;">
            <div class="results-header">
                <h2><i class="fas fa-chart-line"></i> Calculation Results</h2>
                <div class="action-buttons">
                    <button id="downloadPDF" class="btn-secondary">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                    <button id="shareBtn" class="btn-secondary">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                </div>
            </div>

            <!-- Tree Info Summary -->
            <div class="tree-summary card">
                <h3 id="treeName">Tree Information</h3>
                <div class="tree-details" id="treeDetails"></div>
            </div>

            <!-- Results Cards Grid -->
            <div class="results-grid">
                <!-- Biomass Card -->
                <div class="result-card card">
                    <div class="card-icon biomass-icon">
                        <i class="fas fa-weight"></i>
                    </div>
                    <h3>Total Biomass</h3>
                    <div class="result-value" id="biomassValue">0</div>
                    <div class="result-unit">kg</div>
                    <div class="result-breakdown">
                        <small>Above-ground: <span id="agbValue">0</span> kg</small>
                        <small>Below-ground: <span id="bgbValue">0</span> kg</small>
                    </div>
                </div>

                <!-- Carbon Stored Card -->
                <div class="result-card card">
                    <div class="card-icon carbon-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <h3>Carbon Stored</h3>
                    <div class="result-value" id="carbonValue">0</div>
                    <div class="result-unit">kg C</div>
                    <div class="result-info">
                        <small>Locked in tree biomass</small>
                    </div>
                </div>

                <!-- CO2 Sequestration Card -->
                <div class="result-card card highlight">
                    <div class="card-icon co2-icon">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <h3>CO‚ÇÇ Absorbed</h3>
                    <div class="result-value" id="co2Value">0</div>
                    <div class="result-unit">kg CO‚ÇÇ/year</div>
                    <div class="result-info">
                        <small>Annual carbon sequestration</small>
                    </div>
                </div>

                <!-- Oxygen Production Card -->
                <div class="result-card card highlight">
                    <div class="card-icon oxygen-icon">
                        <i class="fas fa-wind"></i>
                    </div>
                    <h3>Oxygen Produced</h3>
                    <div class="result-value" id="oxygenValue">0</div>
                    <div class="result-unit">kg O‚ÇÇ/year</div>
                    <div class="result-info">
                        <small>Fresh air generated</small>
                    </div>
                </div>

                <!-- Air Pollution Card -->
                <div class="result-card card">
                    <div class="card-icon pollution-icon">
                        <i class="fas fa-smog"></i>
                    </div>
                    <h3>Pollution Absorbed</h3>
                    <div class="result-value" id="pollutionValue">0</div>
                    <div class="result-unit">kg/year</div>
                    <div class="result-info">
                        <small>PM2.5, NO‚ÇÇ, SO‚ÇÇ removed</small>
                    </div>
                </div>

                <!-- Economic Value Card -->
                <div class="result-card card">
                    <div class="card-icon economic-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <h3>Economic Value</h3>
                    <div class="result-value" id="economicValue">0</div>
                    <div class="result-unit">‚Çπ/year</div>
                    <div class="result-info">
                        <small>Carbon credit value</small>
                    </div>
                </div>
            </div>

            <!-- Environmental Impact Summary -->
            <div class="card impact-summary">
                <h3><i class="fas fa-globe-americas"></i> Environmental Impact</h3>
                <div class="impact-grid">
                    <div class="impact-item">
                        <i class="fas fa-users"></i>
                        <div>
                            <strong id="peopleEquivalent">0</strong>
                            <small>People's oxygen supply (annual)</small>
                        </div>
                    </div>
                    <div class="impact-item">
                        <i class="fas fa-car"></i>
                        <div>
                            <strong id="carEquivalent">0</strong>
                            <small>km of car emissions offset</small>
                        </div>
                    </div>
                    <div class="impact-item">
                        <i class="fas fa-home"></i>
                        <div>
                            <strong id="homeEquivalent">0</strong>
                            <small>Days of home energy offset</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Know Your Tree - Agricultural Info Card -->
            <div class="tree-info-card" id="treeInfoCard" style="display: none;">
                <h3><i class="fas fa-book-open"></i> Know Your Tree - Agricultural Guide</h3>
                <div id="treeInfoContent">
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-leaf"></i> Uses:</span>
                        <span id="treeUses"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-seedling"></i> Benefits:</span>
                        <span id="treeBenefits"></span>
                    </div>
                    <div class="info-item fact-highlight">
                        <span class="info-label"><i class="fas fa-lightbulb"></i> Did You Know?</span>
                        <span id="treeFact"></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section class="card history-section">
            <div class="history-header">
                <h2><i class="fas fa-history"></i> Calculation History</h2>
                <button id="clearHistory" class="btn-clear">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>
            <div id="historyList" class="history-list">
                <p class="no-history">No calculations yet. Start by calculating a tree's impact!</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>üåç Based on research: AGB = 34.4703 - 8.0671√óD + 0.6589√óD¬≤</p>
            <p>Made with üíö for a greener planet | <strong>EcoTree Tracker</strong></p>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="module" src="firebase-config.js"></script>
    <script src="tree-data.js"></script>
    <script src="calculator.js"></script>
    <script src="app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swPath = window.location.hostname === 'localhost' ? './service-worker.js' : '/eco-tree-tracker/service-worker.js';
                navigator.serviceWorker.register(swPath)
                    .then(reg => console.log('‚úÖ Service Worker registered!'))
                    .catch(err => console.log('‚ùå Service Worker registration failed:', err));
            });
        }

        // PWA Install Button Logic
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex';
        });

        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.choiceResult;
            
            if (outcome === 'accepted') {
                console.log('üéâ App installed!');
            }
            
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ EcoTree Tracker installed successfully!');
            installBtn.style.display = 'none';
        });
        
        // Listen for service worker updates
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
                    showUpdateNotification(event.data.version);
                }
            });
            
            // Check for updates on page load
            navigator.serviceWorker.ready.then(registration => {
                registration.update();
            });
        }
        
        // Show update notification
        function showUpdateNotification(version) {
            // Remove existing notification if any
            const existing = document.getElementById('updateNotification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.id = 'updateNotification';
            notification.innerHTML = `
                <div class="update-popup">
                    <div class="update-icon">üöÄ</div>
                    <div class="update-content">
                        <h3>New Update Available!</h3>
                        <p>Version ${version} with new features & improvements</p>
                        <p class="update-note">‚ú® Premium UI + Tree Information for Agriculture Students</p>
                    </div>
                    <div class="update-buttons">
                        <button onclick="location.reload()" class="update-btn-primary">
                            <i class="fas fa-download"></i> Update Now
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
        }
        
        // Auto check for updates every time page loads
        window.addEventListener('load', () => {
            const lastVersion = localStorage.getItem('ecotree_version');
            const currentVersion = '2.0.0';
            
            if (lastVersion !== currentVersion) {
                // Show update popup for new users or when version changes
                setTimeout(() => {
                    showUpdateNotification(currentVersion);
                    localStorage.setItem('ecotree_version', currentVersion);
                }, 1500);
            }
        });
    </script>
    <style>
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        .update-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            z-index: 10001;
            text-align: center;
            min-width: 350px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .update-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .update-content h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .update-content p {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .update-note {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 10px;
            margin-top: 15px !important;
            font-size: 0.9rem !important;
        }
        
        .update-buttons {
            margin-top: 25px;
        }
        
        .update-btn-primary {
            background: white;
            color: #764ba2;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .update-btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #updateNotification::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 10000;
        }
        
        /* Floating Leaves */
        .leaves-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        
        .leaf {
            position: absolute;
            font-size: 20px;
            animation: falling linear infinite;
            opacity: 0.7;
        }
        
        @keyframes falling {
            0% {
                transform: translateY(-100px) rotate(0deg) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg) translateX(100px);
                opacity: 0.3;
            }
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .dark-mode-toggle:hover {
            transform: scale(1.1) rotate(15deg);
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: fixed;
            top: 160px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 5px 20px rgba(0, 212, 170, 0.4);
            transition: all 0.3s ease;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
        }
        
        .sound-toggle.muted i::before {
            content: "\\f6a9";
        }
        
        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            --dark-color: #f8f9fa;
            --light-color: #2d3436;
        }
        
        body.dark-mode .header,
        body.dark-mode .card {
            background: rgba(45, 52, 54, 0.95);
            color: #f8f9fa;
        }
        
        body.dark-mode .header h1 {
            background: linear-gradient(135deg, #00d4aa, #4facfe, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        body.dark-mode .header p,
        body.dark-mode .form-group label,
        body.dark-mode h2, body.dark-mode h3 {
            color: #f8f9fa;
        }
        
        body.dark-mode .form-group input,
        body.dark-mode .form-group select {
            background: #3d3d3d;
            color: #f8f9fa;
            border-color: #555;
        }
        
        body.dark-mode .result-card h3,
        body.dark-mode .result-unit {
            color: #ddd;
        }
        
        body.dark-mode .dark-mode-toggle {
            background: linear-gradient(135deg, #ffd700, #f39c12);
        }
    </style>
    
    <script>
        // ========== FLOATING LEAVES ==========
        function createLeaves() {
            const container = document.getElementById('leavesContainer');
            const leafEmojis = ['üçÉ', 'üåø', 'üçÇ', '‚òòÔ∏è', 'üå±'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const leaf = document.createElement('div');
                    leaf.className = 'leaf';
                    leaf.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
                    leaf.style.left = Math.random() * 100 + '%';
                    leaf.style.animationDuration = (Math.random() * 10 + 10) + 's';
                    leaf.style.fontSize = (Math.random() * 15 + 15) + 'px';
                    leaf.style.animationDelay = Math.random() * 5 + 's';
                    container.appendChild(leaf);
                    
                    // Remove leaf after animation
                    setTimeout(() => leaf.remove(), 20000);
                }, i * 2000);
            }
            
            // Continuously create leaves
            setInterval(() => {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                leaf.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
                leaf.style.left = Math.random() * 100 + '%';
                leaf.style.animationDuration = (Math.random() * 10 + 10) + 's';
                leaf.style.fontSize = (Math.random() * 15 + 15) + 'px';
                container.appendChild(leaf);
                setTimeout(() => leaf.remove(), 20000);
            }, 3000);
        }
        
        // ========== DARK MODE ==========
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        
        function updateDarkModeIcon() {
            if (document.body.classList.contains('dark-mode')) {
                darkModeIcon.className = 'fas fa-sun';
            } else {
                darkModeIcon.className = 'fas fa-moon';
            }
        }
        
        // Check saved preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            updateDarkModeIcon();
        }
        
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            updateDarkModeIcon();
        });
        
        // ========== SOUND EFFECTS ==========
        let soundEnabled = true;
        
        function playSound(type) {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'click') {
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'success') {
                oscillator.frequency.value = 523.25; // C5
                gainNode.gain.value = 0.1;
                oscillator.start();
                setTimeout(() => oscillator.frequency.value = 659.25, 100); // E5
                setTimeout(() => oscillator.frequency.value = 783.99, 200); // G5
                oscillator.stop(audioContext.currentTime + 0.4);
            }
        }
        
        // ========== CONFETTI EFFECT ==========
        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#667eea', '#764ba2', '#f093fb', '#00d4aa', '#ffd700', '#ff6b6b', '#4facfe'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    container.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 20);
            }
            
            playSound('success');
        }
        
        // Hook confetti to calculate button
        document.addEventListener('DOMContentLoaded', () => {
            createLeaves();
            
            // Add confetti on successful calculation
            const originalDisplayResults = window.displayResults;
            if (typeof displayResults === 'function') {
                const form = document.getElementById('treeForm');
                form.addEventListener('submit', () => {
                    setTimeout(createConfetti, 500);
                });
            }
        });
        
        // Add click sounds to all buttons
        document.addEventListener('click', (e) => {
            if (e.target.matches('button, .btn-primary, .btn-secondary, .tree-option')) {
                playSound('click');
            }
        });
    </script>
</body>
</html>
